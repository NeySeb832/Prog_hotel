{% extends "admin_hotel/base_admin.html" %}

{% block title %}Detalle cliente · HotelManager{% endblock %}

{% block page_title %}Detalle de cliente{% endblock %}
{% block page_subtitle %}
Ficha del cliente y su historial de reservas
{% endblock %}

{% block content %}
<div class="row g-3">
  <div class="col-12 col-lg-4">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-2">
          {% if cliente.get_full_name %}
            {{ cliente.get_full_name }}
          {% else %}
            {{ cliente.username }}
          {% endif %}
        </h5>
        <p class="mb-1">
          <span class="badge bg-secondary-subtle text-secondary-emphasis">
            Usuario: {{ cliente.username }}
          </span>
        </p>
        {% if cliente.email %}
          <p class="mb-1">
            <i class="bi bi-envelope"></i>
            <span class="ms-1">{{ cliente.email }}</span>
          </p>
        {% endif %}

        <p class="mb-2">
          {% if cliente.is_active %}
            <span class="badge bg-success-subtle text-success-emphasis">
              Activo
            </span>
          {% else %}
            <span class="badge bg-danger-subtle text-danger-emphasis">
              Inactivo
            </span>
          {% endif %}
        </p>

        <hr>

        <p class="mb-1 small text-muted">
          Reservas activas: {{ reservas_activas.count }}
        </p>
        <p class="mb-0 small text-muted">
          Total de reservas: {{ reservas.count }}
        </p>

        <hr>

        <div class="d-flex gap-2">
          <a href="{% url 'clientes:editar' cliente.pk %}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-pencil"></i> Editar
          </a>
          <a href="{% url 'clientes:eliminar' cliente.pk %}" class="btn btn-outline-danger btn-sm">
            <i class="bi bi-trash"></i> Eliminar
          </a>
          <a href="{% url 'clientes:lista' %}" class="btn btn-light btn-sm ms-auto">
            Volver al listado
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h6 class="card-title mb-3">Reservas del cliente</h6>

        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>Código</th>
                <th>Habitación</th>
                <th>Fechas</th>
                <th>Estado</th>
                <th class="text-end">Importe</th>
              </tr>
            </thead>
            <tbody>
            {% for r in reservas %}
              <tr>
                <td>{{ r.code }}</td>
                <td>
                  Hab. {{ r.room.codigo }}
                </td>
                <td>
                  <div class="small">
                    {{ r.check_in }} → {{ r.check_out }}
                  </div>
                  <div class="small text-muted">
                    {{ r.nights }} noche{% if r.nights != 1 %}s{% endif %}
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary-subtle text-secondary-emphasis">
                    {{ r.get_status_display }}
                  </span>
                </td>
                <td class="text-end">
                  $ {{ r.total_amount }}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center py-3 text-muted">
                  El cliente no tiene reservas registradas.
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}
