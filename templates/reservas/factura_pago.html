<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{ payment.invoice_number }} · {{ hotel_nombre }}</title>
  <style>
    body {
      font-family: DejaVu Sans, Arial, sans-serif;
      font-size: 12px;
      color: #111827;
    }
    .header, .footer {
      width: 100%;
    }
    .header td {
      vertical-align: top;
      font-size: 11px;
    }
    .title {
      font-size: 18px;
      font-weight: bold;
      text-transform: uppercase;
    }
    .muted {
      color: #6b7280;
    }
    .mt-1 { margin-top: 4px; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mb-1 { margin-bottom: 4px; }
    .mb-2 { margin-bottom: 8px; }
    .text-right {
      text-align: right;
    }
    .text-center {
      text-align: center;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
    }
    .table th, .table td {
      border: 1px solid #e5e7eb;
      padding: 4px 6px;
    }
    .table thead th {
      background-color: #f3f4f6;
      font-weight: bold;
      font-size: 11px;
    }
    hr {
      border: 0;
      border-top: 1px solid #e5e7eb;
      margin: 10px 0;
    }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <table class="header">
    <tr>
      <td style="width: 60%;">
        <div class="title">{{ hotel_nombre }}</div>
        <div class="mt-1">
          <div>{{ hotel_direccion }}</div>
          <div>NIT: {{ hotel_nit }}</div>
          <div>Tel: {{ hotel_telefono }}</div>
          <div>Email: {{ hotel_email }}</div>
        </div>
      </td>
      <td style="width: 40%; text-align: right;">
        <div style="font-size: 16px; font-weight: bold;">FACTURA</div>
        <div class="mt-1">
          <div><strong>N°:</strong> {{ payment.invoice_number }}</div>
          <div><strong>Fecha de emisión:</strong> {{ payment.created_at|date:"Y-m-d H:i" }}</div>
          <div><strong>Reserva:</strong> {{ reservation.code }}</div>
        </div>
      </td>
    </tr>
  </table>

  <hr class="mt-2"/>

  <!-- Datos huésped / reserva -->
  <table style="width: 100%; margin-top: 4px;">
    <tr>
      <td style="width: 50%;">
        <strong>Datos del huésped</strong>
        <div class="mt-1">
          <div>{{ reservation.guest_name }}</div>
          {% if reservation.guest_email %}
            <div class="muted">{{ reservation.guest_email }}</div>
          {% endif %}
          {% if reservation.guest_phone %}
            <div class="muted">{{ reservation.guest_phone }}</div>
          {% endif %}
        </div>
      </td>
      <td style="width: 50%;">
        <strong>Datos de la reserva</strong>
        <div class="mt-1">
          <div>
            <strong>Habitación:</strong>
            {{ reservation.room.codigo }}
            {% if reservation.room.tipo %}
              · {{ reservation.room.tipo.nombre }}
            {% endif %}
          </div>
          <div>
            <strong>Check-in:</strong> {{ reservation.check_in|date:"Y-m-d" }}
          </div>
          <div>
            <strong>Check-out:</strong> {{ reservation.check_out|date:"Y-m-d" }}
          </div>
          <div>
            <strong>Noches:</strong> {{ reservation.nights }}
          </div>
          <div>
            <strong>Tarifa / noche:</strong> ${{ reservation.base_rate }}
          </div>
        </div>
      </td>
    </tr>
  </table>

  <!-- Detalle alojamiento -->
  <h4 class="mt-3 mb-1">Detalle de alojamiento</h4>
  <table class="table">
    <thead>
      <tr>
        <th>Descripción</th>
        <th class="text-center">Noches</th>
        <th class="text-right">Tarifa / noche</th>
        <th class="text-right">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          Alojamiento habitación {{ reservation.room.codigo }}
          {% if reservation.room.tipo %}
            · {{ reservation.room.tipo.nombre }}
          {% endif %}
        </td>
        <td class="text-center">
          {{ reservation.nights }}
        </td>
        <td class="text-right">
          ${{ reservation.base_rate }}
        </td>
        <td class="text-right">
          ${{ total_reserva }}
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Servicios adicionales -->
  <h4 class="mt-3 mb-1">Servicios adicionales</h4>
  {% if consumos_servicios %}
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Servicio</th>
          <th class="text-center">Cantidad</th>
          <th class="text-right">Precio unitario</th>
          <th class="text-right">Total</th>
        </tr>
      </thead>
      <tbody>
        {% for c in consumos_servicios %}
          <tr>
            <td class="muted">
              {{ c.creado_en|date:"Y-m-d H:i" }}
            </td>
            <td>
              {{ c.servicio.nombre }}
              {% if c.notas %}
                <div class="muted" style="font-size: 10px;">
                  {{ c.notas|truncatechars:80 }}
                </div>
              {% endif %}
            </td>
            <td class="text-center">
              {{ c.cantidad }}
            </td>
            <td class="text-right">
              ${{ c.precio_unitario }}
            </td>
            <td class="text-right">
              ${{ c.total }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="muted mt-1">
      No se registran servicios adicionales para esta reserva.
    </div>
  {% endif %}

  <!-- Resumen financiero -->
  <h4 class="mt-3 mb-1">Resumen financiero</h4>
  <table class="table">
    <tbody>
      <tr>
        <th style="width: 60%;">Total alojamiento</th>
        <td class="text-right" style="width: 40%;">${{ total_reserva }}</td>
      </tr>
      <tr>
        <th>Total servicios</th>
        <td class="text-right">${{ total_servicios }}</td>
      </tr>
      <tr>
        <th>Total general (alojamiento + servicios)</th>
        <td class="text-right">${{ total_general }}</td>
      </tr>
      <tr>
        <th colspan="2" class="muted">Pagos de alojamiento (reserva)</th>
      </tr>
      <tr>
        <td class="text-right">Pagado antes de este pago</td>
        <td class="text-right">${{ total_pagado_reserva_antes }}</td>
      </tr>
      <tr>
        <td class="text-right">Este pago</td>
        <td class="text-right">${{ pago_actual_reserva }}</td>
      </tr>
      <tr>
        <td class="text-right">Total pagado alojamiento</td>
        <td class="text-right">${{ total_pagado_reserva_despues }}</td>
      </tr>
      <tr>
        <th colspan="2" class="muted">Pagos de servicios</th>
      </tr>
      <tr>
        <td class="text-right">Total pagado en servicios</td>
        <td class="text-right">${{ total_pagado_servicios }}</td>
      </tr>
      <tr>
        <th>Total pagado (alojamiento + servicios)</th>
        <td class="text-right">${{ total_pagado_general }}</td>
      </tr>
      <tr>
        <th>Saldo pendiente</th>
        <td class="text-right">${{ saldo_pendiente }}</td>
      </tr>
    </tbody>
  </table>

  <div class="mt-3 muted">
    Este documento es una representación de la factura generada por el sistema de gestión del hotel.
  </div>

</body>
</html>
